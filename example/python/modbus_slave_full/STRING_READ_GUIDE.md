# å­—ç¬¦ä¸²è¯»å–åŠŸèƒ½å¿«é€Ÿå‚è€ƒ

## âœ¨ æ–°å¢žåŠŸèƒ½

**è‡ªåŠ¨å­—ç¬¦ä¸²è§£ç ** - åœ¨è¯»å–æ–‡ä»¶è®°å½•æ—¶ï¼Œå¦‚æžœå¯„å­˜å™¨æ•°æ®åŒ…å«å¯æ‰“å°å­—ç¬¦ï¼Œä¼šè‡ªåŠ¨è§£ç å¹¶æ˜¾ç¤ºä¸ºå­—ç¬¦ä¸²ï¼

## ðŸŽ¯ ä½¿ç”¨æ–¹æ³•

### Webç•Œé¢æ“ä½œ

1. **è®¿é—®** http://localhost:8080
2. **åˆ‡æ¢** åˆ° "ðŸ“ æ–‡ä»¶è®°å½•" æ ‡ç­¾
3. **ä½¿ç”¨** "FC20 è¯»å–æ–‡ä»¶è®°å½•" è¡¨å•

#### ç¤ºä¾‹ï¼šè¯»å–è®¾å¤‡åç§°

```
è®°å½•å·:   10
é•¿åº¦:     4
```

**æ˜¾ç¤ºç»“æžœ**:
```
âœ… è¯»å–æˆåŠŸ

æ–‡ä»¶ç¼–å·: 0
è®°å½•ç¼–å·: 10
è®°å½•é•¿åº¦: 4
æ•°æ®: [20556, 12589, 12337, 12544]

æ˜ å°„: ä¿æŒå¯„å­˜å™¨ [10-13]

ðŸ“ å­—ç¬¦ä¸²è§£ç :
æ–‡æœ¬: "PLC-001"
åå…­è¿›åˆ¶: [0x504C, 0x432D, 0x3030, 0x3100]
```

### APIä½¿ç”¨

**è¯»å–æ•°æ®**:
```bash
curl "http://localhost:8080/api/data?slave_id=1"
```

**æ‰‹åŠ¨è§£ç **:
```python
def decode_registers(regs):
    text = ""
    for reg in regs:
        high = (reg >> 8) & 0xFF
        low = reg & 0xFF
        if high >= 32 and high <= 126:
            text += chr(high)
        if low >= 32 and low <= 126:
            text += chr(low)
    return text

# ä½¿ç”¨ç¤ºä¾‹
registers = [20556, 12589, 12337, 12544]
text = decode_registers(registers)
print(text)  # "PLC-001"
```

## ðŸ“Š åŠŸèƒ½å¯¹æ¯”

| æ•°æ®ç±»åž‹ | å¯„å­˜å™¨å€¼ç¤ºä¾‹ | æ˜¾ç¤ºæ–¹å¼ |
|----------|--------------|----------|
| çº¯å­—ç¬¦ä¸² | [18533, 27756] | æ˜¾ç¤ºæ•°å€¼ + å­—ç¬¦ä¸²è§£ç  "Hello" |
| çº¯æ•°å€¼ | [1000, 2000, 3000] | ä»…æ˜¾ç¤ºæ•°å€¼ |
| æ··åˆæ•°æ® | [21332, 14893, 12597] | æ˜¾ç¤ºæ•°å€¼ + å­—ç¬¦ä¸²è§£ç  "Temp:25C" |

## ðŸ” æ™ºèƒ½è¯†åˆ«è§„åˆ™

ç³»ç»Ÿä¼šæ£€æŸ¥å¯„å­˜å™¨æ˜¯å¦åŒ…å«å¯æ‰“å°ASCIIå­—ç¬¦ (32-126):

- **æœ‰å¯æ‰“å°å­—ç¬¦** â†’ æ˜¾ç¤ºå­—ç¬¦ä¸²è§£ç 
- **æ— å¯æ‰“å°å­—ç¬¦** â†’ ä»…æ˜¾ç¤ºæ•°å€¼

å¯æ‰“å°ASCIIèŒƒå›´:
```
32-126: ç©ºæ ¼åˆ°~
åŒ…æ‹¬: A-Z, a-z, 0-9, æ ‡ç‚¹ç¬¦å·
```

## ðŸ’¡ å®žé™…åº”ç”¨ç¤ºä¾‹

### 1. è®¾å¤‡è¯†åˆ«

```bash
# å†™å…¥è®¾å¤‡ID
curl -X POST http://localhost:8080/api/write/string \
  -H "Content-Type: application/json" \
  -d '{"slave_id": 1, "address": 0, "text": "DEV-12345"}'

# åœ¨Webç•Œé¢è¯»å–
è®°å½•å·: 0, é•¿åº¦: 5
â†’ è‡ªåŠ¨æ˜¾ç¤º "DEV-12345"
```

### 2. å›ºä»¶ç‰ˆæœ¬

```bash
# å†™å…¥ç‰ˆæœ¬
curl -X POST http://localhost:8080/api/write/string \
  -H "Content-Type: application/json" \
  -d '{"slave_id": 1, "address": 10, "text": "v3.2.1"}'

# åœ¨Webç•Œé¢è¯»å–
è®°å½•å·: 10, é•¿åº¦: 4
â†’ è‡ªåŠ¨æ˜¾ç¤º "v3.2.1"
```

### 3. è¿è¡ŒçŠ¶æ€

```bash
# å†™å…¥çŠ¶æ€
curl -X POST http://localhost:8080/api/write/string \
  -H "Content-Type: application/json" \
  -d '{"slave_id": 1, "address": 20, "text": "ONLINE"}'

# åœ¨Webç•Œé¢è¯»å–
è®°å½•å·: 20, é•¿åº¦: 4
â†’ è‡ªåŠ¨æ˜¾ç¤º "ONLINE"
```

## ðŸŽ¨ æ˜¾ç¤ºæ ¼å¼

### å­—ç¬¦ä¸²æ•°æ®
```
âœ… è¯»å–æˆåŠŸ

æ–‡ä»¶ç¼–å·: 0
è®°å½•ç¼–å·: 10
è®°å½•é•¿åº¦: 4
æ•°æ®: [18533, 27756, 28527, 8481]

æ˜ å°„: ä¿æŒå¯„å­˜å™¨ [10-13]

ðŸ“ å­—ç¬¦ä¸²è§£ç :
æ–‡æœ¬: "Hello!"
åå…­è¿›åˆ¶: [0x4865, 0x6C6C, 0x6F6F, 0x2121]
```

### çº¯æ•°å€¼æ•°æ®
```
âœ… è¯»å–æˆåŠŸ

æ–‡ä»¶ç¼–å·: 0
è®°å½•ç¼–å·: 40
è®°å½•é•¿åº¦: 5
æ•°æ®: [500, 600, 700, 800, 900]

æ˜ å°„: ä¿æŒå¯„å­˜å™¨ [40-44]
```

## ðŸ› ï¸ è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹åŽŸå§‹å¯„å­˜å™¨å€¼

```bash
curl -s "http://localhost:8080/api/data?slave_id=1" | \
  python3 -c "
import json, sys
data = json.load(sys.stdin)
regs = data['holding_registers'][10:14]
print('å¯„å­˜å™¨å€¼:', regs)
for i, reg in enumerate(regs):
    print(f'å¯„å­˜å™¨[{10+i}]: {reg} = 0x{reg:04X}')
"
```

### è§£ç éªŒè¯

```python
# å®Œæ•´è§£ç ç¤ºä¾‹
import requests

response = requests.get("http://localhost:8080/api/data?slave_id=1")
data = response.json()
registers = data['holding_registers'][10:14]

print(f"å¯„å­˜å™¨å€¼: {registers}")

text = ""
for reg in registers:
    high = (reg >> 8) & 0xFF
    low = reg & 0xFF
    
    h_char = chr(high) if 32 <= high <= 126 else '?'
    l_char = chr(low) if 32 <= low <= 126 else '?'
    
    print(f"0x{reg:04X} â†’ '{h_char}{l_char}' ({high}, {low})")
    
    if 32 <= high <= 126:
        text += chr(high)
    if 32 <= low <= 126:
        text += chr(low)

print(f"\nè§£ç æ–‡æœ¬: '{text}'")
```

## ðŸ“ ç¼–ç è§„åˆ™å›žé¡¾

```
å¯„å­˜å™¨ (16ä½) = é«˜å­—èŠ‚ (8ä½) + ä½Žå­—èŠ‚ (8ä½)
                 ç¬¬1ä¸ªå­—ç¬¦      ç¬¬2ä¸ªå­—ç¬¦

ç¤ºä¾‹:
"Hi" â†’ 0x4869
  H: 0x48 = 72
  i: 0x69 = 105
  å¯„å­˜å™¨å€¼: (72 << 8) | 105 = 18537
```

## âš¡ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œå®Œæ•´æ¼”ç¤º
./demo_string_autodecode.sh

# å¿«é€Ÿå†™å…¥æµ‹è¯•å­—ç¬¦ä¸²
curl -X POST http://localhost:8080/api/write/string \
  -H "Content-Type: application/json" \
  -d '{"slave_id": 1, "address": 5, "text": "TEST"}'

# åœ¨Webç•Œé¢è¯»å–
# è®°å½•å·: 5, é•¿åº¦: 2
```

## ðŸŽ¯ æœ€ä½³å®žè·µ

1. **å­—ç¬¦ä¸²é•¿åº¦è®¡ç®—**: å¯„å­˜å™¨æ•° = âŒˆå­—ç¬¦æ•° / 2âŒ‰
   - 3ä¸ªå­—ç¬¦ â†’ 2ä¸ªå¯„å­˜å™¨
   - 10ä¸ªå­—ç¬¦ â†’ 5ä¸ªå¯„å­˜å™¨

2. **åœ°å€è§„åˆ’**: ä¸ºä¸åŒç±»åž‹æ•°æ®åˆ†é…ä¸“ç”¨åœ°å€æ®µ
   ```
   0-9:    è®¾å¤‡ä¿¡æ¯
   10-19:  é…ç½®å‚æ•°
   20-29:  çŠ¶æ€ä¿¡æ¯
   30-99:  æ•°æ®åŒº
   ```

3. **è¯»å–é•¿åº¦**: è¯»å–æ—¶é•¿åº¦ç¨å¤§ä¸€äº›ï¼Œä»¥å®Œæ•´æ˜¾ç¤ºå­—ç¬¦ä¸²
   ```
   å·²çŸ¥å­—ç¬¦ä¸²10å­—ç¬¦ â†’ è¯»å–6ä¸ªå¯„å­˜å™¨ï¼ˆ12å­—ç¬¦å®¹é‡ï¼‰
   ```

## ðŸ†• ç‰ˆæœ¬ç‰¹æ€§

- âœ… **v1.0**: åŸºç¡€å­—ç¬¦ä¸²å†™å…¥/è¯»å–
- âœ… **v1.1**: è‡ªåŠ¨å­—ç¬¦ä¸²è§£ç ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰
- ðŸ”œ **v1.2**: ä¸­æ–‡å­—ç¬¦ä¼˜åŒ–æ”¯æŒ

---

**äº«å—æ™ºèƒ½å­—ç¬¦ä¸²è§£ç åŠŸèƒ½ï¼** ðŸ“âœ¨
